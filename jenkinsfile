pipeline {
  agent any
    environment {
        AZURE_CLIENT_ID     = credentials('az-client-id')
        AZURE_CLIENT_SECRET = credentials('az-client-secret')
        AZURE_TENANT_ID     = credentials('az-tenant-id')
        WORKSPACE           = '/home/shared/'
    }

  stages {
    stage('Clonar Repositorio') {
      steps {
        // Clonar el repositorio desde GitHub
        dir($WORKSPACE){
          git url: 'https://github.com/alanfvn/IAC-Test.git' 
          echo "Descargado el repositorio de la IAC"
        }
      }
    }

    stage('Autenticaci贸n de Azure'){
      steps {
        sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'
        echo "Autenticado mediante Azure correctamente!"
      }
    }

    stage('Preparaci贸n de terraform') {
      steps {
        dir($WORKSPACE){
          sh('terraform init')
          echo "Finalizada la ejecuci贸n de terraform init"
          sh('terraform plan')
          echo "Finalizada la ejecuci贸n de terraform plan"
        }
      }
    }
  }
}
