pipeline {
  agent any
    environment {
        AZURE_CLIENT_ID     = credentials('az-client-id')
        AZURE_CLIENT_SECRET = credentials('az-client-secret')
        AZURE_TENANT_ID     = credentials('az-tenant-id')
        AZURE_SUBSCRIPTION  = 'Azure subscription 1'
    }

  stages {
    stage('Clonar Repositorio') {
      steps {
        // Clonar el repositorio desde GitHub
        git url: 'https://github.com/alanfvn/IAC-Test.git'
          echo "Descargado el repositorio de la IAC"
      }
    }

    stage('Autenticación de Azure'){
      steps {
        sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'
        echo "Autenticado mediante Azure correctamente!"
      }
    }

    stage('Ejecución de Terraform init') {
      steps {
        sh('terraform init')
          echo "Finalizada la ejecución de terraform init"
      }
    }
  }
}
